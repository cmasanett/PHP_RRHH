<?php
// module/Album/view/album/album/index.phtml:
$title = 'Propiedades de Empresa o Liquidaci贸n';
// $this->headTitle($title);
?>

<link rel="stylesheet" type="text/css" media="screen"
	href="../js/jqueryUI/jquery-ui.theme.min.css" />
<link rel="stylesheet" type="text/css" media="screen"
	href="../js/jqGrid/css/ui.jqgrid.css" />

<!-- <script src="../js/jqGrid/jquery-1.4.2.min.js" type="text/javascript"></script> -->
<script src="//code.jquery.com/jquery-1.11.0.min.js"
	type="text/javascript"></script>
<script src="//code.jquery.com/jquery-migrate-1.2.1.min.js"
	type="text/javascript"></script>
<script src="../js/jqGrid/js/i18n/grid.locale-es.js"
	type="text/javascript"></script>
<script src="../js/jqGrid/js/minified/jquery.jqGrid.min.js"
	type="text/javascript"></script>

<h1><?php echo $this->escapeHtml($title); ?></h1>
<?php
	$flash = $this->flashMessenger ()->setMessageOpenFormat ( '<div%s>' )->setMessageSeparatorString ( '' )->setMessageCloseString ( '</div>' );
?>

<br>
<div class="content">
	<div class="row">
		<div class="col-xs-6">
			<div class="row">
				<div class="col-xs-6 col-md-4">
					<a class="btn btn-success" id="btnAddPropiedadEmpLiq">Alta</a>
			              <?php echo $flash->render('add_correcto',array('btn', 'btn-success'));?>
			              <?php echo $flash->render('eliminado',array('btn', 'btn-success'));?>
			  </div>
				<div class="col-xs-6 col-md-4">
					<a class="btn btn-danger" id="btnDelPropiedadEmpLiq">Baja</a>
			              <?php echo $flash->render('add_correcto',array('btn', 'btn-success'));?>
			              <?php echo $flash->render('eliminado',array('btn', 'btn-success'));?>
			  
			  </div>
				<div class="col-xs-6 col-md-4">
					<a class="btn btn-primary" id="btnEditPropiedadEmpLiq">Modificaci贸n</a>
			              <?php echo $flash->render('add_correcto',array('btn', 'btn-success'));?>
			              <?php echo $flash->render('eliminado',array('btn', 'btn-success'));?>
			  </div>
			</div>
			<br>
			<div id="grid">
				<table id="gridPropEmpLiq"></table>
				<div id="pagerPropEmpLiq"></div>
			</div>
		</div>
		<div class="col-xs-6">
			<div class="row">
				<div class="col-xs-6 col-md-4">
					<a class="btn btn-success" id="btnAddPropiedadEmpLiqVal">Alta</a>
			  </div>
				<div class="col-xs-6 col-md-4">
					<a class="btn btn-danger" id="btnDelPropiedadEmpLiqVal">Baja</a>
			  </div>
				<div class="col-xs-6 col-md-4">
					<a class="btn btn-primary" id="btnEditPropiedadEmpLiqVal">Modificaci贸n</a>
			  </div>
			</div>
			<br>
			<div id="grid">
				<table id="gridPropEmpLiqVal"></table>
				<div id="pagerPropEmpLiqVal"></div>
			</div>
		</div>
	</div>
</div>

<script type="text/javascript">
$(document).ready(function () {
    $("#gridPropEmpLiq").jqGrid({
    	width: 900,
        height: 240,
        autowidth: true,
        rownumbers: true,
        rownumWidth: 40, 
        url:"<?php echo $this->url('propempliq', array('action'=>'loadDataGrid'));?>",
        datatype: 'json',
        mtype: 'POST',
        colNames: ["Id", "Propiedad", "Tipo"],
        colModel: [
            {name:'id', index:'id',
                width:55,
                align: "center",
                hidden:false
            },
            {name:'descripcion', index:'descripcion',
                width:50,
                align: "center",
                sortable:true,
                editable:true,
                editoptions:{size:30}
            },
            {name:'tipo_de_campo', index:'tipo_de_campo',
                width:50,
                align: "center",
                sortable:true,
                editable:true,
                editoptions:{size:30}
            }
        ],
        pager: "#pagerPropEmpLiq",
        rowNum: 10,
        rowList: [10, 20, 30],
        sortname: "id",
        sortorder: "asc",
        viewrecords: true,
        viewsortcols: [true,'horizontal',true],
        gridview: true,
        hidegrid: false,
        autoencode: true,
        forceFit : true,
        pgbuttons: false,
   		editurl:"<?php echo $this->url('propempliq', array('action'=>'addGridItem'));?>",
        caption: "Propiedades de Empresa/Liquidaci贸n",
        onSelectRow: function(id, form){  
        	//getDataRow(id);
        	//alert(id);
        	loadGridPropEmpLiqVal(id);
        }
    });

    $("#gridPropEmpLiq").navGrid("#pagerPropEmpLiq",
                {edit:false,add:false,del:false,search:false,refresh:true,view:false});

    $("#gridPropEmpLiqVal").jqGrid({
    	width: 900,
        height: 240,
        autowidth: true,
        rownumbers: true,
        rownumWidth: 40, 
        //url:"<?php echo $this->url('propempliq', array('action'=>'loadDataGridVal'));?>",
//         datatype: 'json',
        datatype: "local",
//         mtype: 'POST',
        colNames: ["Id", "PropiedadId", "Valor", "Significado"],
        colModel: [
            {name:'id', index:'id',
                width:55,
                align: "center",
                hidden:false
            },
            {name:'propiedad_id', index:'propiedad_id',
                width:55,
                align: "center",
                hidden:false
            },
            {name:'valor_posible', index:'valor_posible',
                width:50,
                align: "center",
                sortable:true,
                editable:true,
                editoptions:{size:30}
            },
            {name:'significado', index:'significado',
                width:50,
                align: "center",
                sortable:true,
                editable:true,
                editoptions:{size:30}
            }
        ],
        pager: "#pagerPropEmpLiqVal",
        rowNum: 10,
        rowList: [10, 20, 30],
        sortname: "id",
        sortorder: "asc",
        viewrecords: true,
        viewsortcols: [true,'horizontal',true],
        gridview: true,
        hidegrid: false,
        autoencode: true,
        forceFit : true,
        pgbuttons: false,
   		//editurl:"<?php echo $this->url('propempliq', array('action'=>'addGridItemVal'));?>",
        caption: "Valores Posibles" 
    });

    $("#gridPropEmpLiqVal").navGrid("#pagerPropEmpLiq",
                {edit:false,add:false,del:false,search:false,refresh:true,view:false});

    $("#btnAddPropiedadEmpLiq").click(function(){
        jQuery("#gridPropEmpLiq").jqGrid('editGridRow',"new", 
                {top:  ($(window).height()/2)- 150,
                left: ($(window).width()/2)- 200,
                jqModal:true,
                recreateForm:false,
                closeOnEscape:true,
                closeAfterAdd:true,
                reloadAfterSubmit:true,
                afterShowForm: function (formid) {
                    $("#descripcion", formid).focus();
                    },
                afterSubmit: function(response,postdata)
                {                                                    
                     var obj = $.parseJSON(response.responseText);                    
                        if(obj.type == "success"){
                        	<?php echo $flash->render('add_correcto',array('btn', 'btn-success'));?>
                            //$('#jqsuccess span').html(obj.msj);
                            //$('#jqsuccess').dialog('open');
                            //gridReload();
                            return [true, ''];                                                          
                        }else if(obj.type == "error"){
                            //$('#jqerror span').html(obj.msj);
                            //$('#jqerror').dialog('open');
                            return [false, obj.msj];
                        }          
                }
            });
    });

    $("#btnDelPropiedadEmpLiq").click(function(){ 
    	var rowid = jQuery("#gridPropEmpLiq").jqGrid('getGridParam','selrow'); 
        if( rowid != null ) {
        	$.ajax({
  		      url: "<?php echo $this->url('propempliq', array('action'=>'deleteGridItem'));?>",
  		      global: false,
  		      type: "POST",
  		      data: "id="+rowid,
  		      dataType: "json",
  		      async:false,
  		      success: function(msg){
  		    	 gridReload();	      		      
//   				 if(msg.type == 'success'){
//   					 if(msg.msj.length > 0){
//   				            var destinos = '';
//   				            for (var i = 0; i < msg.msj.length; i++) {
//   				            	destinos += '<option value="'+msg.msj[i].destinoexportacionid+'">'+msg.msj[i].nombre+'</option>';
//   				               }
//   				            $("#select-destino").html(destinos);	            
  				           
//   				        }
  						
//   					}else
//   	  					{
//   						alert(msg.type);
//   	  					}
  				}						  
  			});
//             jQuery("#gridPropEmpLiq").jqGrid('delGridRow',gr,{
//                 reloadAfterSubmit:true
//                 }); 
        }
        else {
            alert("Please Select Row to delete!"); 
        }
    });

    $("#btnEditPropiedadEmpLiq").click(function(){ 
    	var rowid = jQuery("#gridPropEmpLiq").jqGrid('getGridParam','selrow'); 
        if( rowid != null ) {
	    	jQuery("#gridPropEmpLiq").jqGrid('editGridRow', rowid,
	    		{top:  ($(window).height()/2)- 150,
	            left: ($(window).width()/2)- 200,
	            jqModal:true,
	            recreateForm:false,
	            closeOnEscape:true,
	            closeAfterAdd:true,
	            reloadAfterSubmit:true,
	            afterShowForm: function (formid) {
	                $("#descripcion", formid).focus();
	                },
// 	            afterSubmit: function(response,postdata)
// 	            {                                                    
// 	            	var obj = $.parseJSON(response.responseText);                    
//                     if(obj.type == "success"){
//                         gridReload();
//                         return [true, ''];                                                          
//                     }else if(obj.type == "error"){
//                         return [false, obj.msj];
//                     }          
// 	            }
	        });
        }
        else {
            alert("Please Select Row to edit!"); 
        }
    });
}); 

function gridReload(){
	$("#gridPropEmpLiq").setGridParam({datatype:'json'}).setGridParam({ rowNum: 10 }).trigger('reloadGrid');
}

function loadGridPropEmpLiqVal(id){
	if(id != null){
		$("#gridPropEmpLiqVal").jqGrid('setGridParam',	
			{url:"<?php echo $this->url('propempliq', array('action' => 'loadDataGridVal', 'id' => id));?>"}
			).trigger('reloadGrid');
	}
	else {
	    alert("Please Select Row!!!"); 
	}
}
        
function getDataRow(id){
	var data = $("#gridPropEmpLiqVal").jqGrid('getRowData',id); 
}
</script>